<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title> OpenSSL </title> 
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../Assets/stylesPages.css"> 
    <script src="../../Assets/scriptPages.js"></script>
</head>
<body>
<h1> OpenSSL (ver 4.0.0) </h1>
    <p> Updated ( 2020-06-16 )</p>
    <p class="sitenav"> 
        <a href="../../index.html" title="home">MySite></a>
        <a href="../index.html" title="home">OpenSSL (Cryptography)></a> OpenSSL
    </p>
<table class="table">
<caption> 
    Commands 
    <span class="changeListOrder">[Ordered: <span>Alphabetically</span>]</span>
</caption>
    <tr>
        <th style="width:30%;"> Command </th>
        <th> Description </th>
    </tr>
    <tr class="07.01">
        <td> <em>openssl</em> ciphers <small>[-v] [-s]</small> </td>
        <td>  
            - (no argument) print OpenSSL chiper list <br>
            - (<small>-v</small>) verbose list (includes SSL/TLS version)<br>
            - (<small>-s</small>) supported ciphers with consistent security level only <br>
        </td>
    </tr>
    <tr class="06.02">
        <td> <em>openssl</em> list -commands </td>
        <td> 
            - prints available openssl commands 
        </td>
    </tr>
    <tr class="06.03">
        <tr><td></td><td></td></tr>
    <tr class="06.04">
        <td> <em>openssl</em> list -cipher-commands </td>
        <td> 
            - prints available cipher commands (cipher list) 
        </td>
    </tr>
    <tr class="08.01">
        <td> <em>openssl</em> s_client -connect <strong>host:port</strong> <small>[-reconnect] [-no_ticket]</small> </td>
        <td> 
            - creates a generic TLS/SSL client connects to the specified host (-connect <strong>host:port</strong>), it returns various useful TLS informations (Cipher Suite used, Server Certificate, Session Ticket, TLS version, etc..) <br>
            - (<small>-reconnect</small>) reconnects to the same server 5 times (test if the server session resumption is working) <br>
            - (<small>-no_ticket</small>) disables session ticket (forces the client to resume with session Id) (Session resumption) (TLSv1.3 does not support session ID's resumptions only ticket based resumption) 
        </td>
        </td>
    </tr>
    <tr class="05.01">
        <td> <em>openssl</em> version <small>[-a] </td>
        <td> 
            - prints the openssl version number <br>
            - <small>[-a]</small> detailed version informations 
        </td>
    <tr class="10.01">
        <td colspan="2"> symmetric encrytion </td>
    </tr>
    <tr class="11.01">
        <td> <em>openssl</em> enc -<strong>cipherCmd</strong> <small>[-base64]</small> -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> </td>
        <td> 
            - encrypt the passed file (-in <strong>file</strong>) with the passed cipher suite (-<strong>cipherCmd</strong>) <br>
            - (<small>-base64</small>) data in base64 encoded after encryption <br>
            - (<small>-out <strong>file</strong></small>) stores the encrypted data in the specified file 
        </td>
    </tr>
    <tr class="12.01">
        <td> <em>openssl</em> enc -<strong>cipherCmd</strong> -d <small>[-base64]</small> -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> </td>
        <td> 
            - decrypts the passed file (-in <strong>file</strong>) with the passed cipher suite (-<strong>cipherCmd</strong>) <br>
            - (<small>-base64</small>) reads the passed file in base64 encoding <br>
            - (<small>-out <strong>file</strong></small>) stores the decrypted data in the specified file 
        </td>
    </tr>
    <tr class="15.01">
        <td colspan="2"> asymmetric encrytion </td>
    </tr>
    <tr class="15.02">
        <td> <em>openssl</em> genrsa -out <strong>file</strong> <small>[nr:bit]</small> </td>
        <td> 
            - generates a private-key file (should be <mark>.pem</mark>) (generated key file also contains data to generate its public key) <br>
            - (<small>nr:bit</small>) key size in bits (Default <mark>2048</mark> bits)
        </td>
    </tr>
    <tr class="15.04">
        <td> <em>openssl</em> rsa -in <strong>keyFile</strong> -text </td>
        <td> 
            - prints all key components (including data which is used to generate the public-key) 
        </td>
    </tr>
    <tr class="15.03">
        <td> <em>openssl</em> rsa -in <strong>privKey</strong> -pubout -out <strong>pubKey</strong> </td>
        <td> 
            - generates the public-key pair (should be <mark>.pem</mark>) of the passed pirvate key (-in <strong>privKey</strong>) <br>
            - (<small>-out <strong>pubKey</strong></small>) stores the public-key in the specified file                         
        </td>
    </tr>
    <tr class="16.02">
        <td> <em>openssl</em> rsautl -decrypt -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> -inkey <strong>privKey</strong> </td>
        <td> 
            - decrypts with the private-key the passed file (previously encrypted with the private-key's public-key) <br>
            - (<small>-out <strong>file</strong></small>) stores the decrypted data in the specified file                         
        </td>
    </tr>
    <tr class="16.01">
        <td> <em>openssl</em> rsautl -encrypt -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> -inkey <strong>pubKey</strong> -pubin </td>
        <td> 
            - uses a public-key (-inkey <strong>pubKey</strong>) to encrypt the passed file (-in <strong>file</strong>) <br>
            - (<small>-out <strong>file</strong></small>) stores the encrypted data in the specified file  
        </td>
    </tr> 
    <tr class="17.01">
        <td> <em>openssl</em> rsautl -sign -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> -inkey <strong>privKey</strong> </td>
        <td>  
            - uses the private-key to sign the passed file (-in <strong>file</strong>) (encrypting with the private-key)<br>
            - (<small>-out <strong>file</strong></small>) stores the signed data in the specified file 
        </td>
    </tr> 
    <tr class="17.02">
        <td> <em>openssl</em> rsautl -verify -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> -inkey <strong>pubKey</strong> -pubin </td>
        <td>  
            - uses the public-key to verify if the passed file (-in <strong>file</strong>) was signed with the private-key pair (decrypting the sigined file) <br>
            - (<small>-out <strong>file</strong></small>) stores the verified (decrypted) data in the specified file 
        </td>
    </tr> 
    <tr class="18.01">
        <td colspan="2"> certificate </td>
    </tr>
    <tr class="20.01">
        <td> <em>openssl</em> pkcs12 -export -in <strong>cert</strong> -inkey <strong>privKey</strong> <small>[-certfile <strong>caCert</strong>]</small> <small>[-out <strong>file</strong>]</small> </td>
        <td>  
            - generates a <mark>.pfx</mark> or <mark>.p12</mark> file (file containing both the private-key and certificate encrypted) <br>
            - (<small>-certfile <strong>caCert</strong></small>) additional Certificate Authority certificates <br>
            - (<small>-out <strong>file</strong></small>) stores the <mark>.pfx</mark> or <mark>.p12</mark> file in the specified file 
        </td>
    </tr>
    <tr class="19.01">
        <td> <em>openssl</em> req <small>[-days <i>nr</i>]</small> -x509 -newkey rsa:<strong>nr:bit</strong> <small>[-nodes]</small> <small>[-sha256]</small> -keyout <strong>privKey</strong> -out <strong>file</strong> </td>
        <td>  
            - creates a self-signed certificate and private-key pair in <mark>pem</mark> format (will ask for certificate details) <u>(private-key will be encrypted)</u><br>
            - (<small>-days</small>) certificate validity in days (Default: 60) <br>
            - (-newkey rsa:<strong>nr:bit</strong>) defines the size of the private-key in bits <br>
            - (<small>-nodes</small>) does not encrypts the created private-key <br>
            - (<small>-sha256</small>) uses sha-256 bit encryption algorithms <br> 
            - (<small>-out <strong>file</strong></small>) stores the certificate in the specified file 
        </td>
    </tr>
    <tr class="18.02">
        <td> <em>openssl</em> req -new <small>[-sha256]</small> -key <strong>privKey</strong> <small>[-out <strong>file</strong>]</small> </td>
        <td>  
            - creates a new Certificate Signing Request (CSR) <br>
            - (<small>-sha256</small>) uses sha-256 bit encryption algorithms <br> 
            - (<small>-out <strong>file</strong></small>) stores the Certificate Signing Request in the specified file 
        </td>
    </tr>
    <tr class="21.02">
        <td> <em>openssl</em> x509 -enddate -noout -in <strong>cert</strong> </td>
        <td> 
            - prints the expiration date of the passed certificate (-in <strong>cert</strong>) 
        </td>
    </tr>
    <tr class="22.01">
        <td> <em>openssl</em> rsautl -encrypt -in <strong>file</strong> <small>[-out <strong>file</strong>]</small> -inkey <strong>cert</strong> -certin </td>
        <td> 
            - uses a certificate (-inkey <strong>cert</strong>) to encrypt the passed file (-in <strong>file</strong>) (which can be decrypted with the private key pair) <br>
            - (<small>-out <strong>file</strong></small>) stores the encrypted data in the specified file 
        </td>
    </tr> 
    <tr class="18.03">
        <td> <em>openssl</em> x509 -req -in <strong>csr</strong> -signkey <strong>privKey</strong> <small>[-out <strong>file</strong>]</small> </td>
        <td>  
            - self-signes (with the passed private-key (-signkey <strong>privKey</strong>)) the passed Certificate Signing Request (-in <strong>csr</strong>) <br>
            - (<small>-out <strong>file</strong></small>) stores the self-signed certificate in the specified file (should be <mark>.pem</mark> or <mark>.cer</mark>)
        </td>
    </tr>
    <tr class="21.01">
        <td> <em>openssl</em> x509 -in <strong>cer</strong> -text </td>
        <td> 
            - prints the certificate <br>
            - (<small>-text</small>) prints detailes information about the certificate (expiration, comon name (hostname), certificate itself, etc...)   
        </td>
    </tr>
</table>
<h2 style="color:green;"><u> Notes : </u></h2>
    <details class="example" id="notes">
    <summary> Notes :</summary>
        <!-- <p> - paragraph removes the 'empty' message from the detail TAG -->
    </details>
<h2 style="color:green;"><u> Useful Links : </u></h2>
    <p><a href="https://www.openssl.org/" target="_blank">OpenSSL.org</a></p>
<h2 style="color:green;"><u> Remember This : </u></h2>
    <p> - the certificate's <mark>CN</mark> (Common Name) must match the server's hostname </p>
<h2 style="color:green;"><u> Description and Demonstration : </u></h2>
    <p> - OpenSSL is a general purpose cryptography library, can be used for general cryptography (encrypting, decrypting, signing, ect.. files) </p> 
    <p> - it's also a toolkit for TLS/SSL (TLS Certificate Singning Request, Certificate, etc...) </p>
    <p> - OpenSSL's secure heap prevents sensitive data from leaking due to pointer overruns or underruns <u>(this features is not automatically enabled (allocated)! [TESTED: 2021-01-11 in node.js <mark>--secure-heap</mark> flag])</u></p>
<hr>
<!--------------------------------------------------------------------------------------------------------->
<h2 style="color:darkblue;"><u> Symmetric Encryption </u></h2>
    <pre class="cmd">
// encryption -------------------------------------------------------------------------
    pall@Ryzen:~/TestDir$ openssl enc -aes-256-cbc -in 'Janos Vitez' -out 'Janos Vitez (encrypted)'     // encrypted 'Janos Vitez (encrypted)' file created  
        enter aes-256-cbc encryption password:
        Verifying - enter aes-256-cbc encryption password:
    
// decryption -------------------------------------------------------------------------
    pall@Ryzen:~/TestDir$ openssl enc -aes-256-cbc -d -in 'Janos Vitez (encrypted)' -out 'Janos Vitez (decrypted)'  // decrypting in a new file 
        enter aes-256-cbc decryption password:
    </pre>
<hr>
<!--------------------------------------------------------------------------------------------------------->
<h2 style="color:darkblue;"><u> Asymmetric Encryption </u></h2>
    <ol>
        <li> creating a private key (file contains its public key data) </li>
        <li> generate the public key pair of the created private key </li>
        <li> encyrpt a file with the public key </li>
        <li> decrypt the encrypted file with the private key pair </li>
    </ol>
    <pre class="cmd"> 
// generating a private key -----------------------------------------------------------
    pall@Ryzen:~/TestDir$ openssl genrsa -out privKey.pem 3000                         // generates a 3000bit rsa private key ('privKey.pem')
    
// creating a public key --------------------------------------------------------------
    pall@Ryzen:~/TestDir$ openssl rsa -in key.pem -pubout -out pubKey.pem              // creates the private key's public key pair     // -! the file contains only the public key   
    writing RSA key
    
// encryption with the public key -----------------------------------------------------
    pall@Ryzen:~/TestDir$ openssl rsautl -encrypt -in janVit -out janVit_enc -inkey pubKey.pem -pubin   // encrypts the 'janVit' file by using the public key ('pubKey.pem') 
    
// decryption with the private key pair -----------------------------------------------
    pall@Ryzen:~/TestDir$ openssl rsautl -decrypt -in janVit_enc -out janVit_dec -inkey privKey.pem     // decrypt the 'janVit_enc' file by using the private key pair ('privKey.pem')
    </pre>
<hr>
<!--------------------------------------------------------------------------------------------------------->
<h3 style="color:darkblue;"><u> Signing files </u></h3>
    <ol>
        <li> signing a file with the private key (encrypt the file) </li>
        <li> verifying the signed file with the public-key pair (decrypt the signed file) </li>
    </ol>
    <pre class="cmd"> 
// signing a file with the private key (encrypt)---------------------------------------
    pall@Ryzen:~/TestDir$ openssl rsautl -sign -in janVit -out janVit_signed -inkey privKey.pem                 // signes the 'janVit' file with the private key (encrypts the file)
    
// verifying signed file (decrypt) ----------------------------------------------------
    pall@Ryzen:~/TestDir$ openssl rsautl -verify -in janVit_signed -out janVit_read -inkey pubKey.pem -pubin    // veryfies the signed file with the public-key (decrypts the signed file)   
    </pre>
<hr>
<!--------------------------------------------------------------------------------------------------------->
<h3 style="color:darkblue;"><u> Certificate Signing Request / Self-Signed Certificate </u></h3>
    <ol>
        <li> Creating a Certificate Signing Request (CSR) </li>
        <li> Self-Sign the CSR with the private-key </li>
        <li> creating a <mark>.pfx</mark> file (which contains both the private-key and the certificate) </li>
    </ol>
    <pre class="cmd">
// creating a Certificat Signing Request ----------------------------------------------
pall@Ryzen:~/TestDir$ openssl req -new -sha256 -key pallKey.pem -out pallCsr.csr       // creates a certificate signing request created with the associated private-key   
    You are about to be asked to enter information that will be incorporated
    into your certificate request.  // ... CSR form
    
// self-signing -----------------------------------------------------------------------
pall@Ryzen:~/TestDir$ openssl x509 -req -in pallCsr.csr -signkey pallKey.pem -out pallCer.cer       // self-signing the csr 'pallcsr.csr'  
    Signature ok                    // ... Certificate Signed  
    
// creating a .pfx file ---------------------------------------------------------------
pall@Ryzen:~/TestDir$ openssl pkcs12 -export -in pallCer.cer -inkey pallKey.pem -out pallKyes.pfx   // creates a .pfx file (which contains both the private-key and the certificate)   
    Enter Export Password:          // ... 
    </pre>
    <p> - creating a self-signed certificate and private-key pair </p>
    <pre class="cmd">
    pall@Ryzen:~/TestDir$ openssl req -x509 -newkey rsa:2048 -nodes -sha256 -keyout pallKey.pem -out pallCer.cer    
    </pre>
<details class="example">
<summary> Example : </summary>
<h4 style="color:darkblue;"><u> creating Certificate Signing Request filet then self-sign it TEST </u></h4>
    <pre class="cmd">
pall@Ryzen:~/TestDir$ openssl genrsa -out pallKey.pem                                  // generate a pirvate-key 
    Generating RSA private key, 2048 bit long modulus (2 primes)
    ............................................................................+++++
    .....................+++++
    e is 65537 (0x010001)
pall@Ryzen:~/TestDir$ openssl req -new -sha256 -key pallKey.pem -out pallCsr.csr       // creates a certificate signing request with the private-key
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [AU]:RO
    State or Province Name (full name) [Some-State]:Harghita
    Locality Name (eg, city) []:Zetea
    Organization Name (eg, company) [Internet Widgits Pty Ltd]:.
    Organizational Unit Name (eg, section) []:.
    Common Name (e.g. server FQDN or YOUR name) []:.
    Email Address []:.

    Please enter the following 'extra' attributes
    to be sent with your certificate request
    A challenge password []:.
    An optional company name []:.
pall@Ryzen:~/TestDir$ openssl x509 -req -in pallCsr.csr -signkey pallKey.pem -out pallCert.cer  // slef-signs the certificate signing request 
    Signature ok
    subject=C = RO, ST = Harghita, L = Zetea
    Getting Private key
pall@Ryzen:~/TestDir$ 
    </pre>
<hr>
<!--------------------------------------------------------------------------------------------------------->
<h4 style="color:darkblue;"><u> encyrpt with a certificate then decrypt TEST </u></h4>
    <pre class="cmd">
pall@Ryzen:~/TestDir$ ls
    janVit  pallCert.cer  pallCsr.csr  pallKey.pem
pall@Ryzen:~/TestDir$ openssl rsautl -encrypt -in janVit -out janVit_enc -inkey pallCert.cer -certin    // encrypting with the self-signed certificate   
pall@Ryzen:~/TestDir$ ls
    janVit  janVit_enc  pallCert.cer  pallCsr.csr  pallKey.pem
pall@Ryzen:~/TestDir$ openssl rsautl -decrypt -in janVit_enc -inkey pallKey.pem        // decrypting with the private-key pair  
    Petőfi Sándor
    
    János Vitéz
    
    Tüzesen süt le a nyári nap sugára
    Az ég tetejéről a juhászbojtárra.
    Fölösleges dolog sütnie oly nagyon,
    A juhásznak úgyis nagy melege vagyon.
    
pall@Ryzen:~/TestDir$ 
    </pre>
<!--------------------------------------------------------------------------------------------------------->
<h4 style="color:darkblue;"><u> create <mark>.pfx</mark> file TEST </u></h4>
    <pre class="cmd">
pall@Ryzen:~/TestDir$ ls
    janVit  pallCert.cer  pallCsr.csr  pallKey.pem
pall@Ryzen:~/TestDir$ openssl pkcs12 -export -in pallCert.cer -inkey pallKey.pem -out pall.pfx      // creating .pfx file 
    Enter Export Password:
    Verifying - Enter Export Password:
pall@Ryzen:~/TestDir$ ls
    janVit  pallCert.cer  pallCsr.csr  pallKey.pem  pall.pfx
pall@Ryzen:~/TestDir$     
    </pre>
    
    
    
    
    
</details>

<br><br>
</body>
</html>